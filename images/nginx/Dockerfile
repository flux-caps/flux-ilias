FROM nginx:1.20-alpine

RUN unlink /etc/nginx/conf.d/default.conf
COPY ./rewrites.conf /etc/nginx/ilias-rewrites.conf

ENV ILIAS_WEB_DIR /var/www/html

ENV ILIAS_NGINX_LOG_DIR /var/log/nginx
ENV ILIAS_NGINX_ACCESS_LOG_FILE $ILIAS_NGINX_LOG_DIR/access.log
ENV ILIAS_NGINX_ACCESS_LOG_LEVEL main
ENV ILIAS_NGINX_ERROR_LOG_FILE $ILIAS_NGINX_LOG_DIR/error.log
ENV ILIAS_NGINX_ERROR_LOG_LEVEL warn

#ENV ILIAS_NGINX_HTTPS_CERT
#ENV ILIAS_NGINX_HTTPS_KEY
#ENV ILIAS_NGINX_HTTPS_DHPARAM

ENV ILIAS_NGINX_HTTP_PORT 80
ENV ILIAS_NGINX_HTTPS_PORT 443

ENV ILIAS_NGINX_LISTEN 0.0.0.0

ENV ILIAS_NGINX_PHP_HOST ilias
ENV ILIAS_NGINX_PHP_PORT 9000

ENV ILIAS_NGINX_SERVER_TOKENS off

VOLUME $ILIAS_NGINX_LOG_DIR
VOLUME $ILIAS_WEB_DIR

EXPOSE $ILIAS_NGINX_HTTP_PORT
EXPOSE $ILIAS_NGINX_HTTPS_PORT

WORKDIR $ILIAS_WEB_DIR

COPY ./entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]
