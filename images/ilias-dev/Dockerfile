ARG ILIAS_IMAGE
FROM $ILIAS_IMAGE

RUN pecl install xdebug && \
    docker-php-ext-enable xdebug && \
    docker-php-source delete

ENV ILIAS_PHP_XDEBUG_DISCOVER_CLIENT_HOST true
ENV ILIAS_PHP_XDEBUG_CLIENT_PORT 9003
ENV ILIAS_PHP_XDEBUG_LOG_DIR /var/log/xdebug
ENV ILIAS_PHP_XDEBUG_LOG_FILE $ILIAS_PHP_XDEBUG_LOG_DIR/xdebug.log
ENV ILIAS_PHP_XDEBUG_LOG_LEVEL 7
ENV ILIAS_PHP_XDEBUG_MODE develop,debug,profile
ENV ILIAS_PHP_XDEBUG_OUTPUT_DIR $ILIAS_PHP_XDEBUG_LOG_DIR/output
ENV ILIAS_PHP_XDEBUG_START_WITH_REQUEST trigger

ENV ILIAS_PHP_DISPLAY_ERRORS On

ENV ILIAS_DEVMODE true

VOLUME $ILIAS_PHP_XDEBUG_LOG_DIR

COPY ./entrypoint.sh /entrypoint-dev.sh
RUN chmod +x /entrypoint-dev.sh
ENTRYPOINT ["/entrypoint-dev.sh"]
